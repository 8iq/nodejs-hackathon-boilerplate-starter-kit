// auto generated by kmigrator
// KMIGRATOR:0010_auto_20200604_2012:IyBHZW5lcmF0ZWQgYnkgRGphbmdvIDMuMC42IG9uIDIwMjAtMDYtMDQgMjA6MTIKCmZyb20gZGphbmdvLmRiIGltcG9ydCBtaWdyYXRpb25zLCBtb2RlbHMKaW1wb3J0IGRqYW5nby5kYi5tb2RlbHMuZGVsZXRpb24KCgpjbGFzcyBNaWdyYXRpb24obWlncmF0aW9ucy5NaWdyYXRpb24pOgoKICAgIGRlcGVuZGVuY2llcyA9IFsKICAgICAgICAoJ19kamFuZ29fc2NoZW1hJywgJzAwMDlfYXV0b18yMDIwMDYwNF8xNjQ2JyksCiAgICBdCgogICAgb3BlcmF0aW9ucyA9IFsKICAgICAgICBtaWdyYXRpb25zLkFsdGVyRmllbGQoCiAgICAgICAgICAgIG1vZGVsX25hbWU9J29yZ2FuaXphdGlvbnRvdXNlcmxpbmsnLAogICAgICAgICAgICBuYW1lPSdvcmdhbml6YXRpb24nLAogICAgICAgICAgICBmaWVsZD1tb2RlbHMuRm9yZWlnbktleShkYl9jb2x1bW49J29yZ2FuaXphdGlvbicsIG9uX2RlbGV0ZT1kamFuZ28uZGIubW9kZWxzLmRlbGV0aW9uLkRPX05PVEhJTkcsIHJlbGF0ZWRfbmFtZT0nKycsIHRvPSdfZGphbmdvX3NjaGVtYS5vcmdhbml6YXRpb24nKSwKICAgICAgICApLAogICAgXQo=

exports.up = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Alter field organization on organizationtouserlink
--
SET CONSTRAINTS "OrganizationToUserLink_organization_047b72d2_fk_Organization_id" IMMEDIATE; ALTER TABLE "OrganizationToUserLink" DROP CONSTRAINT "OrganizationToUserLink_organization_047b72d2_fk_Organization_id";
DELETE FROM "OrganizationToUserLink" WHERE "organization" is NULL OR "user" is NULL;
ALTER TABLE "OrganizationToUserLink" ALTER COLUMN "organization" SET NOT NULL;
ALTER TABLE "OrganizationToUserLink" ADD CONSTRAINT "OrganizationToUserLink_organization_047b72d2_fk_Organization_id" FOREIGN KEY ("organization") REFERENCES "Organization" ("id") DEFERRABLE INITIALLY DEFERRED;
COMMIT;

    `)
}

exports.down = async (knex) => {
    await knex.raw(`
    BEGIN;
--
-- Alter field organization on organizationtouserlink
--
SET CONSTRAINTS "OrganizationToUserLink_organization_047b72d2_fk_Organization_id" IMMEDIATE; ALTER TABLE "OrganizationToUserLink" DROP CONSTRAINT "OrganizationToUserLink_organization_047b72d2_fk_Organization_id";
ALTER TABLE "OrganizationToUserLink" ALTER COLUMN "organization" DROP NOT NULL;
ALTER TABLE "OrganizationToUserLink" ADD CONSTRAINT "OrganizationToUserLink_organization_047b72d2_fk_Organization_id" FOREIGN KEY ("organization") REFERENCES "Organization" ("id") DEFERRABLE INITIALLY DEFERRED;
COMMIT;

    `)
}
